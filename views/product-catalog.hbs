<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Featured Services</title>
    <link rel="stylesheet" href="/partials/navbar.css">
    <link rel="stylesheet" href="/featured.css">
    <link rel="stylesheet" href="/book-appointment.css">
    <link rel="stylesheet" href="/cart.css">
    <link rel="stylesheet" href="/product-catalog.css">
    <link rel="stylesheet" href="/product-catalog-header.css">
  </head>

  <body>
    {{> _header}}

    <div id="overlay"></div>

    <header>Product Catalog</header>
    
    <div class="product-container">

      <input type="text" id="searchInput" placeholder="Search products...">

      <div class="products">
        <input type="hidden" name="userId" value="{{user._id}}" id="userId">
        {{#each products}}
        <div class="product" productName="{{this.name}}">
          <img src="/images/products/{{this.photo}}" alt="{{this.name}}">
          <div class="product-details">
            <h3>{{this.name}}</h3>
            <p>{{this.desc}}</p>
            <p style="margin-top: 8px;">Price &euro;<span id="product-price">{{this.price}}</span></p>
            <p>Availability:<span class="product-availability"> {{this.quantity}}</span></p>
            <div class="product-counter">
              <button class="counter-button" id="{{this._id}}-decrement">-</button>
              <span data-prod-id="{{this._id}}" data-availability="{{this.quantity}}" class="quantity" id="{{this._id}}-quantity">1</span>
              <button class="counter-button" id="{{this._id}}-increment">+</button>
            </div>

            {{#if ../user}}
              {{#if (eq ../user.role 'admin')}}
              <button class="productEdit edit-btn" type="button" data-edit-product="{{this._id}}">Edit Product</button>
              {{else}}
              <button class="productAddToCart add-to-cart-btn" type="button" data-id="{{this._id}}" data-owner="{{../user._id}}">Add to Cart</button>
              {{/if}}
            {{else}}
              <button class="productAddToCart add-to-cart-btn" type="button" onclick="showErrorNotLoggedIn()">Add to Cart</button>
            {{/if}}

          </div>
        </div>
        {{/each}}
        
      </div>

      {{#if (eq user.role 'admin')}}
      <button id="addProduct" class="add-to-cart-btn" type="button">Add New Product</button>
      {{/if}}

    </div>

    <!-- EDIT PRODUCT POPUP -->
    <div id="editProductPopup" class="popupContainer" style="display: none;">
      <div class="popupContent">
        <span id="closeEditPopup" class="closePopup">&times;</span>
        <h1>Edit Product</h1>
          <form id="editProductForm">
            <input type="hidden" id="editProductId" name="productId" value="">
            <label for="productName">Product Name</label>
            <input type="text" id="editProductName" name="productName">

            <label for="productDesc">Product Description</label>
            <input type="text" id="editProductDesc" name="productDesc">

            <label for="productPrice">Product Price</label>
            <input type="number" id="editProductPrice" name="productPrice">

            <label for="productAvailability">Product Availability</label>
            <input type="number" id="editProductAvailability" name="productAvailability">

            <p id="error-message" style="color: rgb(255, 72, 72) !important;"></p>
          
            <button data-orig-name="" data-orig-desc="" data-orig-price="" data-orig-quan="" type="submit" id="editSubmit" class="submitBtn">Submit</button>
          </form>
      </div>
    </div>

    <!-- ADD PRODUCT POPUP -->
    <div id="addProductPopup" class="popupContainer" style="display: none;">
      <div class="popupContent">
        <span id="closeAddPopup" class="closePopup">&times;</span>
        <h1>Add New Product</h1>
          <form id="addProductForm">
            <label for="productName">Product Name</label>
            <input type="text" id="addProductName" name="productName" placeholder="">

            <label for="productDesc">Product Description</label>
            <input type="text" id="addProductDesc" name="productDesc" placeholder="">

            <label for="productPrice">Product Price</label>
            <input type="number" id="addProductPrice" name="productPrice" placeholder="">

            <label for="productAvailability">Product Availability</label>
            <input type="number" id="addProductAvailability" name="productAvailability" placeholder="">
          
            <button type="submit" id="addSubmit" class="submitBtn">Submit</button>
          </form>
      </div>
    </div>

    <!-- Error Popup -->
    <div id="errorPopup" class="miniPopupContainer" style="display: none;">
      <div class="popupContent">
        <span id="closePopupError" class="closePopup">&times;</span>
        <h3 style="color: azure;">There seems to be a problem</h3>
        <p id="errorText" style="color: azure;"></p>
      </div>
    </div>

    <!-- Success Popup -->
    <div id="successPopup" class="miniPopupContainer" style="display: none;">
      <div class="popupContent">
        <span id="closePopupSuccess" class="closePopup">&times;</span>
        <h3 style="color: azure;">Success</h3>
        <p id="successText" style="color: azure;"></p>
      </div>
    </div>

    {{#if user}}
      <script src="/js/product-catalog.js"></script>
    {{else}}
        <script src="/js/errorNotLoggedIn.js"></script>
    {{/if}}
    <script src="/js/logout.js"></script>
  </div>

  </body>
</html>